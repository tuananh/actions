# Copyright 2022 Tuan Anh Tran <me@tuananh.org>

name: gen-key
description: |
  This action generate SSH key.
inputs:
  email:
    description: |
      email used for creating the key
    require: true

  signing-key-path:
    description: |
      The path to put the signing key at.
    default: ${{ github.workspace }}/id_rsa

  install-public-key:
    description: |
      Whether to add the generated key to the system APK keyring.
    default: true
  
  output:
    description: |
      Output name to be used in other steps.
    default: ssh_pub_key

runs:
  using: "composite"
  steps:
    - name: Generate ssh key pair
      shell: bash
      run: |
        ssh-keygen -t rsa -b 4096 -C "${{ inputs.email }}" -f ${{ inputs.signing-key-path }} -q -N ""
        echo "::set-output name=ssh_pub_key::$(cat ${{ inputs.signing-key-path }}.pub)"

    # - name: 'Install public key in system keyring'
    #   shell: bash
    #   run: |
    #     sudo cp ${{ inputs.signing-key-path }}.pub /etc/apk/keys/
    #   if: ${{ inputs.install-public-key }}